# 프론트엔드-백엔드 작업 분담 명세서

## 전체 구조

```
프론트엔드 (클라이언트)
├── GUI 렌더링
├── 사용자 인터랙션 처리
├── API 호출
└── 상태 관리

백엔드 (서버)
├── API 엔드포인트
├── 비즈니스 로직
├── 파일 처리
├── 모델 실행
└── 데이터 관리
```

---

## 프론트엔드 작업 항목

### 1. 페이지 구조 및 라우팅
- **담당**: 프론트엔드
- **작업 내용**:
  - 루트 페이지 (`/`) 렌더링
  - 탭 네비게이션 (동작 검색 / 단어 검색)
  - 반응형 레이아웃

### 2. 동작 검색 탭 UI
- **담당**: 프론트엔드
- **작업 내용**:
  - 파일 업로드 드래그 앤 드롭 영역
  - 파일 선택 버튼
  - 업로드된 파일 정보 표시
  - 번역 시작 버튼
  - 진행 상황 프로그레스 바
  - 번역 결과 단어 표시 영역
  - 동영상 플레이어 컴포넌트
  - 키포인트 표시/숨김 토글 버튼

### 3. 파일 업로드 처리
- **담당**: 프론트엔드
- **작업 내용**:
  - 파일 선택/드래그 앤 드롭 이벤트 처리
  - 파일 형식 검증 (클라이언트 사이드)
  - `FormData` 생성
  - `POST /api/upload` 호출
  - 업로드 성공/실패 피드백
  - `file_id` 저장

### 4. 번역 작업 시작
- **담당**: 프론트엔드
- **작업 내용**:
  - 번역 버튼 클릭 이벤트
  - `POST /api/translate` 호출
  - `task_id` 저장
  - SSE 연결 시작

### 5. SSE 연결 및 진행 상황 표시
- **담당**: 프론트엔드
- **작업 내용**:
  - `EventSource` 객체 생성
  - `GET /api/translate/progress/{task_id}` 연결
  - `progress` 이벤트 수신 및 프로그레스 바 업데이트
  - `complete` 이벤트 수신 및 결과 처리
  - `error` 이벤트 수신 및 에러 표시
  - 연결 종료 처리

### 6. 동영상 플레이어
- **담당**: 프론트엔드
- **작업 내용**:
  - HTML5 `<video>` 태그 또는 비디오 플레이어 라이브러리 사용
  - 동영상 URL 설정
  - 재생/일시정지 컨트롤
  - seek 기능
  - 로딩 상태 표시

### 7. 키포인트 표시/숨김 토글
- **담당**: 프론트엔드
- **작업 내용**:
  - 토글 버튼 UI
  - 상태 관리 (`showKeypoints: true/false`)
  - 동영상 URL 전환:
    - `true`: `/api/video/annotated/{task_id}`
    - `false`: `/api/video/original/{task_id}`
  - 플레이어에 새 URL 설정

### 8. 단어 검색 탭 UI
- **담당**: 프론트엔드
- **작업 내용**:
  - 검색 입력 필드
  - 검색 버튼
  - 검색 결과 리스트
  - 각 결과 항목의 동영상 재생 버튼

### 9. 단어 검색 처리
- **담당**: 프론트엔드
- **작업 내용**:
  - 검색어 입력 이벤트
  - `POST /api/search` 호출
  - 검색 결과 리스트 렌더링
  - 결과 없음 메시지 표시

### 10. 사전 동영상 재생
- **담당**: 프론트엔드
- **작업 내용**:
  - 검색 결과 항목 클릭
  - `GET /api/video/dictionary/{word_id}` URL로 동영상 플레이어 설정
  - 동영상 재생

### 11. 에러 처리 및 사용자 피드백
- **담당**: 프론트엔드
- **작업 내용**:
  - API 에러 응답 처리
  - 에러 메시지 표시 (토스트, 알림 등)
  - 네트워크 오류 처리
  - 로딩 스피너 표시

### 12. 상태 관리
- **담당**: 프론트엔드
- **작업 내용**:
  - 업로드된 파일 정보 저장
  - 번역 작업 상태 저장
  - 검색 결과 저장
  - 로컬 상태 또는 상태 관리 라이브러리 사용

---

## 백엔드 작업 항목

### 1. 루트 페이지 서빙
- **담당**: 백엔드
- **작업 내용**:
  - `GET /` 엔드포인트 구현
  - 정적 HTML 파일 또는 템플릿 렌더링
  - 정적 리소스 (CSS, JS) 서빙

### 2. 파일 업로드 API
- **담당**: 백엔드
- **작업 내용**:
  - `POST /api/upload` 엔드포인트 구현
  - `multipart/form-data` 파싱
  - 파일 형식 검증 (확장자, MIME 타입)
  - 파일 크기 제한 검증
  - 임시 디렉토리에 파일 저장
  - 고유 `file_id` 생성
  - 파일 메타데이터 저장
  - 응답 JSON 생성

### 3. 번역 작업 시작 API
- **담당**: 백엔드
- **작업 내용**:
  - `POST /api/translate` 엔드포인트 구현
  - `file_id` 검증 (파일 존재 확인)
  - 고유 `task_id` 생성
  - 작업 큐에 번역 작업 추가
  - 비동기 작업 시작
  - 즉시 `task_id` 반환

### 4. 번역 작업 워커
- **담당**: 백엔드
- **작업 내용**:
  - 작업 큐에서 작업 가져오기
  - 동영상 파일 로드
  - 프레임 추출
  - 키포인트 추출 (MediaPipe, OpenPose 등)
  - 수어 인식 모델 실행
  - 키포인트를 동영상에 그리기
  - 주석 동영상 저장
  - 진행 상황 업데이트 (SSE로 전송)
  - 완료 시 메타데이터 저장

### 5. SSE 진행 상황 스트림
- **담당**: 백엔드
- **작업 내용**:
  - `GET /api/translate/progress/{task_id}` 엔드포인트 구현
  - SSE 스트림 설정 (`text/event-stream`)
  - `task_id` 검증
  - 진행 상황 이벤트 전송:
    - `progress`: 진행률 업데이트
    - `complete`: 완료 및 결과
    - `error`: 오류 발생
  - 연결 유지 및 타임아웃 처리
  - 클라이언트 연결 해제 감지

### 6. 번역 결과 조회 API
- **담당**: 백엔드
- **작업 내용**:
  - `GET /api/translate/result/{task_id}` 엔드포인트 구현
  - `task_id`로 작업 상태 조회
  - 메타데이터 읽기
  - 결과 JSON 반환

### 7. 원본 동영상 스트리밍
- **담당**: 백엔드
- **작업 내용**:
  - `GET /api/video/original/{task_id}` 엔드포인트 구현
  - `task_id`로 파일 경로 조회
  - HTTP Range Requests 처리 (`Range` 헤더)
  - `Content-Range` 헤더 설정
  - 파일 청크 스트리밍
  - 적절한 `Content-Type` 설정

### 8. 주석 동영상 스트리밍
- **담당**: 백엔드
- **작업 내용**:
  - `GET /api/video/annotated/{task_id}` 엔드포인트 구현
  - `task_id`로 주석 파일 경로 조회
  - HTTP Range Requests 처리
  - 파일 청크 스트리밍

### 9. 단어 검색 API
- **담당**: 백엔드
- **작업 내용**:
  - `POST /api/search` 엔드포인트 구현
  - 검색어 파라미터 추출
  - 사전 데이터베이스 검색
  - 결과 리스트 생성
  - JSON 응답 반환

### 10. 사전 동영상 스트리밍
- **담당**: 백엔드
- **작업 내용**:
  - `GET /api/video/dictionary/{word_id}` 엔드포인트 구현
  - `word_id`로 사전 파일 경로 조회
  - 파일 존재 확인
  - HTTP Range Requests 처리
  - 파일 스트리밍

### 11. 파일 관리 시스템
- **담당**: 백엔드
- **작업 내용**:
  - 임시 파일 저장 디렉토리 구조 관리
  - 파일 ID 기반 파일 매핑
  - TTL (Time To Live) 기반 파일 삭제
  - 정기적인 임시 파일 정리 작업
  - 디스크 공간 관리

### 12. 에러 처리 및 로깅
- **담당**: 백엔드
- **작업 내용**:
  - API 에러 핸들링
  - 표준화된 에러 응답 형식
  - 로깅 시스템 (작업 진행, 에러 등)
  - 예외 처리

### 13. 사전 데이터베이스 관리
- **담당**: 백엔드
- **작업 내용**:
  - 사전 데이터베이스 구조 설계
  - 단어-동영상 매핑 저장
  - 검색 인덱싱
  - 사전 데이터 로드

---

## 인터페이스 계약

### 프론트엔드가 백엔드에 기대하는 것
1. **표준화된 API 응답 형식**
   - 성공: `{ "success": true, ... }`
   - 실패: `{ "success": false, "error": "..." }`

2. **SSE 이벤트 형식**
   - `event: progress`, `event: complete`, `event: error`
   - JSON 형식의 `data` 필드

3. **동영상 스트리밍**
   - HTTP Range Requests 지원
   - 적절한 `Content-Type` 헤더

4. **에러 코드**
   - 일관된 에러 메시지 형식

### 백엔드가 프론트엔드에 기대하는 것
1. **파일 업로드**
   - `multipart/form-data` 형식
   - 적절한 파일 형식

2. **SSE 연결**
   - `EventSource` 사용
   - 연결 해제 시 적절한 정리

3. **동영상 재생**
   - Range Requests 지원 플레이어 사용

---

## 기술 스택 제안

### 프론트엔드
- **HTML/CSS/JavaScript** (바닐라 또는 프레임워크)
- **비디오 플레이어**: Video.js, Plyr, 또는 HTML5 video
- **SSE**: 네이티브 `EventSource` API
- **HTTP 클라이언트**: `fetch` API

### 백엔드
- **웹 프레임워크**: Flask, FastAPI, Express.js 등
- **파일 처리**: multer (Node.js), werkzeug (Python) 등
- **비동기 작업**: Celery (Python), Bull (Node.js) 등
- **SSE**: 프레임워크 내장 기능 또는 라이브러리
- **동영상 처리**: OpenCV, FFmpeg
- **키포인트 추출**: MediaPipe, OpenPose
- **수어 인식**: 커스텀 모델 또는 라이브러리

---

## 개발 순서 제안

### Phase 1: 기본 인프라
1. 백엔드: 루트 페이지 서빙
2. 프론트엔드: 기본 UI 구조
3. 백엔드: 파일 업로드 API
4. 프론트엔드: 파일 업로드 UI

### Phase 2: 번역 기능
5. 백엔드: 번역 작업 큐 및 워커
6. 백엔드: SSE 진행 상황 스트림
7. 프론트엔드: 번역 시작 및 진행 상황 표시
8. 백엔드: 동영상 처리 (키포인트 추출/그리기)
9. 백엔드: 동영상 스트리밍 API
10. 프론트엔드: 동영상 플레이어 및 토글

### Phase 3: 검색 기능
11. 백엔드: 사전 데이터베이스 설정
12. 백엔드: 단어 검색 API
13. 프론트엔드: 단어 검색 UI
14. 백엔드: 사전 동영상 스트리밍
15. 프론트엔드: 검색 결과 및 재생

### Phase 4: 최적화 및 정리
16. 파일 정리 시스템
17. 에러 처리 강화
18. 성능 최적화
19. 테스트

